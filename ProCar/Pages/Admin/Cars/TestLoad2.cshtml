@page
@model ProCar.Pages.Admin.Cars.TestLoad2Model
@{
}
@*enctype="multipart/form-data"*@




<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
<script src="https://unpkg.com/filepond/dist/filepond.min.js"></script>
<script src="https://unpkg.com/jquery-filepond/filepond.jquery.js"></script>
<link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet" />
<script src="https://unpkg.com/filepond/dist/filepond.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css"
      rel="stylesheet" />
<script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
<link href="https://unpkg.com/filepond-plugin-file-poster/dist/filepond-plugin-file-poster.css"
      rel="stylesheet" />
<script src="https://unpkg.com/filepond-plugin-file-poster/dist/filepond-plugin-file-poster.js"></script>

<form id="uploadform" method="post" enctype="multipart/form-data">
    <input type="file" class="filepond" name="photos" multiple  />
    <input asp-for="Input.Title"/>
    <button type="submit"> Ok</button>
</form>

<script>
    FilePond.registerPlugin(FilePondPluginImagePreview);
    FilePond.registerPlugin(FilePondPluginFileValidateType);

    FilePond.setOptions({
        labelIdle: 'Перетащите фото или <span class="filepond--label-action"> загрузите </span>',
        acceptedFileTypes: ['image/png'],
        itemInsertLocation : 'after'
        
    });
    var api = "/data/imgs/";

    $(document).ready(function (e) {
        pond = FilePond.create(
            document.querySelector('.filepond'), {
            allowMultiple: true,
            instantUpload: false,
            allowProcess: false,
            server: {
                url: api,
                process: 'upload-file',
                revert: null,
                load: './cars/',
                restore: null,
                fetch: null
            },
            files: [
                {
                    source: "lada.png",
                    options: {
                        type: 'local',
                        //metadata: {
                        //    poster: '127.0.0.1:5042/imgs/lada.png'
                        //}
                        metadata:{
                            name:"lada.png",
                            type: 'image/png'
                        }
                    }
                }

            ]
            
        });


        $("#uploadform").submit(function (e) {
            e.preventDefault();
            var formdata = new FormData(this);
            // append FilePond files into the form data
            pondFiles = pond.getFiles();
            for (var i = 0; i < pondFiles.length; i++) {
                // append the blob file
                formdata.append('photos', pondFiles[i].file);
            }

            $.ajax({
                url: "/admin/cars/testload2",
                data: formdata,

                processData: false,
                contentType: false,
                method: "post",
                success: function (result) {
                    if (result.redirectUrl !== undefined) {
                        window.location.replace(result.redirectUrl);
                    } else {
                        // No redirect found, do something else
                    }
                },

            });

        })
    });
</script>